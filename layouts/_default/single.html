<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>{{ .Title }} – {{ .Site.Title }}</title>
    <link rel="stylesheet" href="/style.css">
  </head>
  <body>
    <header>
      <h1><a href="/">{{ .Site.Title }}</a></h1>
    </header>

    <main>
      {{/* Show the template title only if the page doesn't ask to hide it */}}
      {{ if not .Params.hide_title }}
        <h2>{{ .Title }}</h2>
      {{ end }}

      {{ with .Params.image }}
        <img src="{{ . }}" alt="{{ $.Title }}" />
      {{ end }}

      <article>
        {{ .Content }}
      </article>

      {{/* ----- Robust prev/next: sort, then de-duplicate by permalink ----- */}}
      {{- $sorted := sort site.RegularPages "Date" "asc" "Title" "asc" -}}
      {{- $seen := newScratch -}}
      {{- $uniq := slice -}}
      {{- range $p := $sorted -}}
        {{- $k := $p.Permalink -}}
        {{- if not ($seen.Get $k) -}}
          {{- $uniq = $uniq | append $p -}}
          {{- $seen.Set $k true -}}
        {{- end -}}
      {{- end -}}

      {{- $idx := -1 -}}
      {{- range $i, $p := $uniq -}}
        {{- if eq $p.Permalink $.Permalink -}}
          {{- $idx = $i -}}
        {{- end -}}
      {{- end -}}

      <nav class="post-nav">
        <div class="nav-grid" style="display:flex;gap:1rem;justify-content:space-between">
          <div>
            {{- if ge $idx 1 -}}
              {{- $prev := index $uniq (sub $idx 1) -}}
              <a href="{{ $prev.RelPermalink }}">← Previous</a>
            {{- end -}}
          </div>
          <div><a href="{{ "/" | relURL }}">Back to Home</a></div>
          <div>
            {{- if and (ge $idx 0) (lt (add $idx 1) (len $uniq)) -}}
              {{- $next := index $uniq (add $idx 1) -}}
              <a href="{{ $next.RelPermalink }}">Next →</a>
            {{- end -}}
          </div>
        </div>
      </nav>
    </main>
  </body>
</html>
