<!-- layouts/_default/single.html -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>{{ .Title }} – {{ .Site.Title }}</title>
    <link rel="stylesheet" href="/style.css">
  </head>
  <body>
    <header>
      <h1><a href="/">{{ .Site.Title }}</a></h1>
    </header>

    <main>
      <h2>{{ .Title }}</h2>

      {{ with .Params.image }}
        <img src="{{ . }}" alt="{{ $.Title }}" />
      {{ end }}

      <article>
        {{ .Content }}
      </article>

      {{/* Build a de-duplicated, stably sorted list of posts by permalink */}}
      {{- $all := sort site.RegularPages "Date" "asc" "Title" "asc" -}}
      {{- $seen := newScratch -}}
      {{- $uniq := slice -}}
      {{- range $p := $all -}}
        {{- $key := $p.RelPermalink -}}
        {{- if not ($seen.Get $key) -}}
          {{- $seen.Set $key true -}}
          {{- $uniq = $uniq | append $p -}}
        {{- end -}}
      {{- end -}}

      {{/* Locate current index inside the unique list */}}
      {{- $idx := -1 -}}
      {{- range $i, $p := $uniq -}}
        {{- if eq $p.File.Path .File.Path -}}
          {{- $idx = $i -}}
        {{- end -}}
      {{- end -}}

      <nav class="post-nav">
        <div class="nav-grid" style="display:flex;gap:1rem;justify-content:space-between">
          <div>
            {{- if ge $idx 1 -}}
              {{- $prev := index $uniq (sub $idx 1) -}}
              <a href="{{ $prev.RelPermalink }}">← Previous</a>
            {{- end -}}
          </div>
          <div><a href="{{ "/" | relURL }}">Back to Home</a></div>
          <div>
            {{- if lt (add $idx 1) (len $uniq) -}}
              {{- $next := index $uniq (add $idx 1) -}}
              {{- if ne $next.RelPermalink .RelPermalink -}}
                <a href="{{ $next.RelPermalink }}">Next →</a>
              {{- end -}}
            {{- end -}}
          </div>
        </div>
      </nav>
    </main>
  </body>
</html>
