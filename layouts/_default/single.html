<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>{{ .Title }} – {{ .Site.Title }}</title>
    <link rel="stylesheet" href="/style.css">
    <style>
      /* Title sizing: large but responsive */
      .post-title{
        margin:0 0 1rem 0;
        font-size:clamp(1.9rem, 4.8vw, 2.75rem);
        line-height:1.15;
        letter-spacing:.01em;
        text-align:center;
      }

      /* Nav buttons – consistent sizes without arrows */
      .post-nav{ margin-top:2rem }
      .post-nav .nav-grid{
        display:flex; gap:.75rem; justify-content:space-between; align-items:stretch;
        max-width:920px; margin:0 auto;
      }
      .post-nav a{
        display:inline-block; padding:.6rem .9rem; border-radius:.65rem;
        border:1px solid rgba(255,255,255,.08);
        text-decoration:none;
        background:rgba(0,0,0,.18);
      }
      .post-nav a:focus-visible{ outline:2px solid currentColor; outline-offset:2px }
      .post-nav .center{ text-align:center }

      /* Lutebox label */
      .lute-label{
        text-align:center; opacity:.7; font-size:.9rem; margin:.25rem 0 .5rem 0;
      }
    </style>
  </head>
  <body>
    <header>
      <h1 style="text-align:center;"><a href="/">{{ .Site.Title }}</a></h1>
    </header>

    <main>
      <!-- Big page title only (we'll hide any duplicate inside the article below) -->
      <h1 class="post-title">{{ .Title }}</h1>

      {{ with .Params.image }}
        <img src="{{ . }}" alt="{{ $.Title }}" />
      {{ end }}

      <article>
        {{ .Content }}
      </article>

      <!-- Lutebox small heading (kept) -->
      <div class="lute-label">Lutebox</div>

      {{/* ----- Robust prev/next: sort, then de-duplicate by permalink ----- */}}
      {{- $sorted := sort site.RegularPages "Date" "asc" "Title" "asc" -}}
      {{- $seen := newScratch -}}
      {{- $uniq := slice -}}
      {{- range $p := $sorted -}}
        {{- $k := $p.Permalink -}}
        {{- if not ($seen.Get $k) -}}
          {{- $uniq = $uniq | append $p -}}
          {{- $seen.Set $k true -}}
        {{- end -}}
      {{- end -}}

      {{- $idx := -1 -}}
      {{- range $i, $p := $uniq -}}
        {{- if eq $p.Permalink $.Permalink -}}
          {{- $idx = $i -}}
        {{- end -}}
      {{- end -}}

      <nav class="post-nav" aria-label="Post navigation">
        <div class="nav-grid">
          <div>
            {{- if ge $idx 1 -}}
              {{- $prev := index $uniq (sub $idx 1) -}}
              <a href="{{ $prev.RelPermalink }}" aria-label="Previous">Previous</a>
            {{- end -}}
          </div>
          <div class="center"><a href="{{ "/" | relURL }}">Back to Home</a></div>
          <div>
            {{- if and (ge $idx 0) (lt (add $idx 1) (len $uniq)) -}}
              {{- $next := index $uniq (add $idx 1) -}}
              <a href="{{ $next.RelPermalink }}" aria-label="Next">Next</a>
            {{- end -}}
          </div>
        </div>
      </nav>
    </main>

    <!-- Hide the first in-article heading if it duplicates the page title -->
    <script>
      (function(){
        var t = {{ printf "%q" .Title }}; // safe-quoted title
        var first = document.querySelector('article h1, article h2, article h3');
        if(first && first.textContent.trim().toLowerCase() === t.trim().toLowerCase()){
          first.style.display = 'none';
          first.setAttribute('aria-hidden','true');
        }
      })();
    </script>
  </body>
</html>
