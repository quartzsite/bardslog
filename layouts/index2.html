<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>{{ .Site.Title }}</title>
  <link href="https://fonts.googleapis.com/css2?family=EB+Garamond&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/style.css" />
  <style>
    /* Mobile-first, readable sizes */
    html { font-size: clamp(16px, 2.6vw, 20px); }
    body {
      margin: 0; padding: 2rem;
      font-family: 'EB Garamond', serif;
      background-color: var(--bg-color, #0f0d0c);
      color: var(--text-color, #e7d7b9);
    }
    h1 { text-align: center; margin: 0 0 1.5rem 0; font-size: clamp(1.6rem, 5vw, 2.2rem); }

    .home-content { max-width: 820px; margin: 0 auto 2rem; }

    /* List centered and legible */
    ul { list-style: none; padding: 0; margin: 0 auto; max-width: 60rem; }
    li { margin: .45rem 0; }
    a { text-decoration: underline; text-underline-offset: .15em; }
    a:focus-visible { outline: 2px solid currentColor; outline-offset: 3px; }
    .date { opacity: .85; margin-left: .5ch; }

    .footer-banner { position: relative; width: 100%; overflow: hidden; margin-top: 3rem; }
    .footer-banner img { width: 100%; height: auto; display: block; object-fit: cover; filter: brightness(80%) contrast(95%); }
    .footer-overlay { position: absolute; bottom: 0; width: 100%; height: 40%; background: linear-gradient(to top, rgba(15,13,12,.95), rgba(15,13,12,0)); }
  </style>
</head>
<body>
  <h1>{{ .Site.Title }}</h1>

  {{ with .Content }}
    <div class="home-content">
      {{ . }}
    </div>
  {{ end }}

  <ul>
    {{- /* Build a list that includes EVERY markdown page:
          - regular pages, section _index.md, and the site home if it has content
          - ignore any exclude flags; show all */ -}}
    {{- $all := union (slice .Site.Home) .Site.AllPages -}}
    {{- $md := where $all "File.Ext" "in" (slice "md" "markdown") -}}
    {{- $sorted := sort $md "Date" "asc" "Title" "asc" -}}

    {{- /* Deduplicate by permalink just in case */ -}}
    {{- $seen := newScratch -}}
    {{- range $p := $sorted -}}
      {{- $k := $p.RelPermalink -}}
      {{- if not ($seen.Get $k) -}}
        {{- $seen.Set $k true -}}
        <li>
          <a href="{{ $p.RelPermalink }}">{{ or $p.Title $p.LinkTitle }}</a>
          {{ with $p.Date }}<span class="date">â€” {{ .Format "2006-01-02" }}</span>{{ end }}
        </li>
      {{- end -}}
    {{- end -}}
  </ul>

  <div class="footer-banner">
    <img
      src="https://raw.githubusercontent.com/quartzsite/bardslog/main/static/images/bardslog.png"
      alt="Faelar writing by candlelight - Bardslog banner"
      loading="lazy"
    />
    <div class="footer-overlay"></div>
  </div>
</body>
</html>
